(function(k){var p=window.AmazonUIPageJS||window.P,q=p._namespace||p.attributeErrors,f=q?q("TwisterCoreAsset",""):p;f.guardFatal?f.guardFatal(k)(f,window):f.execute(function(){k(f,window)})})(function(k,p,q){k.when("twister-variation-matrix","twister-dim-util","twister-state-machine","variation-sequence-alter","twister-metadata","twister-view-controller","twister-dispatcher","twister-actions","twister-slots-dimsum","twister-dimsum").register("TwisterCore",function(f,h,g,e,a,b,c,d,l,t){function n(d,
n){this.tvm=new f(d);this.util=new h(this.tvm);this.tsm=new g(this.tvm,this.util,d.initDimCombination);this.dimSum=new t(d.config.ajaxTimeout,d.config.ajaxUrlParams,d.config.deviceType,n);this.slotsDimSum=new l(d.config.ajaxTimeout,d.config.ajaxUrlParams,d.config.deviceType);var m=this;c.registerStore("twister-state-machine",function(a,c){m.tsm.accept(a,c).THEN(function(c){b.publishView(a,c)}).ELSE()});var u=new a;c.registerStore("twister-metadata",function(a,c){u.process(a,c,function(c){b.publishView(a,
c)})});d.sheetViewData&&!0===d.sheetViewData.priceSortingEnabled&&(this.variationSequenceAlter=new e(this.util),c.registerStore("variation-sequence-alter",function(a,c){m.variationSequenceAlter.accept(a,c).THEN(function(c){b.publishView(a,c)}).ELSE()}))}function m(b,a){var e=b.viewAttribution+"_"+b.viewName+"_"+a;return function(b){try{var n=d.create(a,b);c.dispatch(a,n)}catch(l){p.ueLogError&&p.ueLogError(l,{logLevel:"ERROR",attribution:"Twister_view_"+e,message:"This error is caused by the Twister view - "+
e+" while updating the TwisterCore"})}}}n.prototype={registerActive:function(a,c){b.register(a.viewAttribution+"_"+a.viewName,!0,c.updateView);return{dimensionChanged:m(a,"VARIATION_CHANGE"),dimensionPeek:m(a,"VARIATION_PEEK"),variationSequenceAlter:m(a,"VARIATION_SEQUENCE_ALTER"),initSequenceAlterData:m(a,"INIT_SEQUENCE_ALTER_DATA"),metaData:m(a,"METADATA")}},registerPassive:function(a,c){b.register(a.viewAttribution+"_"+a.viewName,!1,c.updateView);return{metaData:m(a,"METADATA")}},state:function(){return this.tsm.currentState().selected().selectionInfo()}};
return n});"use strict";k.when("A").register("twister-actions",function(f){var h=f.$,g={VARIATION_CHANGE:function(e){return e=h.isArray(e)?e:[e]},VARIATION_PEEK:function(e){return e},VARIATION_SEQUENCE_ALTER:function(){},INIT_SEQUENCE_ALTER_DATA:function(e){return e},METADATA:function(e){return e}};return{create:function(e,a){return g[e]?g[e](a):!1}}});"use strict";k.when("A","publisherSubscriber").register("twister-dispatcher",function(f,h){function g(){g=1;return this}var e=f.$,a=new h,g=0,b=[];
return{registerStore:function(b,d){a.register(b,d);return this},deregisterStore:function(b){a.deRegister(b);return this},dispatch:function(c,d){g?b.push(arguments):a.publish(c,d);return this},hold:g,release:function(){e.each(b,function(b,d){a.publish.apply(a,d)});g=0;return this}}});"use strict";k.when("A","publisherSubscriber").register("twister-view-controller",function(f,h){function g(){e?a.push(arguments):(e=1,b.publish.apply(b,arguments),c.publish.apply(c,arguments),e=0,a.length&&g.apply(this,
a.shift()));return this}var e=0,a=[],b=new h,c=new h;return{register:function(a,e,f){e?b.register(a,f):c.register(a,f);return this},deRegister:function(a,e){e?b.deRegister(a):c.deRegister(a);return this},publishView:g}});"use strict";k.when("A").register("twister-dimsel-api",function(f){function h(e){var a=this;this.dimSelectionMap={};this.selInfo=e;g.each(e,function(b,c){a.dimSelectionMap[c.dimKey]=c.val})}var g=f.$;h.prototype={matches:function(e){e=e.selectionInfo();for(var a=0;a<e.length;a++){var b=
e[a].dimKey;if(!(b in this.dimSelectionMap)||this.dimSelectionMap[b]!==e[a].val)return!1}return!0},selectionInfo:function(){return f.copy(this.selInfo)}};return h});"use strict";k.when("A","twister-dimsel-api").register("twister-dim-util",function(f,h){function g(a){this.tvm=a;this.dimensionMetaData={};var b=[];a=a.dimensionInfo;for(var c=0;c<a.length;c++){b.push(a[c].dimKey);var d={};d.isRequired=a[c].isRequired;d.isSingleton=a[c].isSingleton;d.dimOrder=c;d.size=a[c].size;this.dimensionMetaData[a[c].dimKey]=
d}}var e=f.$;g.prototype={createSelectionInfo:function(a){return new h(a)},extendSelectionInfo:function(a,b,c){var d=c||0===c,l={},f=[];e.each(b.selectionInfo(),function(a,b){l[b.dimKey]=b.val});e.each(a.selectionInfo(),function(a,b){a=b.dimKey;b=d?c:b.val;a in l&&(b=l[a]);f.push({dimKey:a,val:b})});return new h(f)},createNextDimSelection:function(a,b){var c=[],d=b.selectionInfo(),l=this;e.each(a.split(":"),function(a,b){var e=d[a].dimKey;b=parseInt(b,10);l.dimensionMetaData[e].isRequired&&b!==d[a].val&&
(b=-1);c.push({dimKey:e,val:b})});return new h(c)},getDimScore:function(a,b){var c=0,d=a.split(":"),l=this;e.each(b.selectionInfo(),function(a,b){var e=b.dimKey;b=b.val;var f=parseInt(d[a],10);a=d.length-a;b===f?(c+=200*a,l.dimensionMetaData[e].isRequired&&(c+=2E4)):c+=100-Math.round(Math.abs(b-f)/l.dimensionMetaData[e].size*100)});return c},isSingletonDim:function(a){return this.dimensionMetaData[a]?this.dimensionMetaData[a].isSingleton:!1},isRequiredDim:function(a){return this.dimensionMetaData[a]?
this.dimensionMetaData[a].isRequired:!1},getDimensionInfo:function(){return this.tvm.dimensionInfo},getDimAvailability:function(a,b){b=b.selectionInfo?b:this.createSelectionInfo(b);var c=[],d=[],l=this.tvm.dimensionList,f=this.tvm.dimtoValueMap[a],n=this.createSelectionInfo([{dimKey:a,val:-1}]);b=this.tvm.fetch(this.extendSelectionInfo(b,n).selectionInfo());var m={},g=this;e.each(b,function(b,c){m[c.split(":")[l.indexOf(a)]]=g.tvm.dimCombinations[c]});e.each(f,function(a,b){a in m?c.push({index:a,
asin:m[a],label:b}):d.push({index:a,label:b})});return{available:c,unavailable:d}},getUnselectedDims:function(a){var b={};e.each(a,function(a,c){b[c.dimKey]=c.val});a=[];var c=this.tvm.dimensionList,d;for(d in c)if(c.hasOwnProperty(d)){var l=c[d];if(void 0===b[l]||-1===b[l])this.isSingletonDim(l)?b[l]=0:a.push(l)}return a},showDimSum:function(a,b){b=this.getUnselectedDims(b);return!b||0===b.length||1===b.length&&b[0]===a?1:0},isFullySelected:function(a){var b=!0;"string"===typeof a&&(a=this.getSelectionInfoFromDimComb(a));
a=a.selectionInfo?a.selectionInfo():a;if(a.length!=this.tvm.dimensionList.length)return!1;e.each(a,function(a,d){-1===d.val&&(b=!1)});return b},createDimensionSelectionMap:function(a){var b={},c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];b[d.dimKey]=d.val}return b},getSelectedDimKeys:function(a){var b=this.tvm.dimensionList,c=[],d;for(d in b)if(b.hasOwnProperty(d)){var e=a[b[d]];"undefined"===typeof e||-1==e?c.push("*"):c.push(e)}return c},getValidDimCombination:function(a,b){var c,d=this,l=0,
f=0;a=this.tvm.fetch(a);e.each(a,function(a,e){f=d.getDimScore(e,b);f>l&&(c=a,l=f)});return a[c]},getAsinFromSelectionInfo:function(a,b){var c;"undefined"==typeof b||b?a=this.createDimensionSelectionMap(a):(c=f.copy(a),a=this.getValidDimCombination(c,this.createSelectionInfo(a)),e.each(a.split(":"),function(a,b){b=parseInt(b,10);c[a].val=b}),a=this.createDimensionSelectionMap(c));a=this.getSelectedDimKeys(a).join(":");return this.tvm.dimCombinations[a]},getSelectionInfoFromSelectedVariationValuesMap:function(a){var b=
[],c;for(c in this.tvm.dimensionList){var d={},e=this.tvm.dimensionList[c];d.dimKey=e;d.val=a[e];b.push(d)}return b},getSelectionInfoFromDimComb:function(a){var b=[];a=a.split("_");for(var c in this.tvm.dimensionList){var d={},e=a[c];d.dimKey=this.tvm.dimensionList[c];d.val="X"===e||"*"===e?-1:parseInt(e,10);b.push(d)}return b},getDimensionDisplayText:function(a){return this.tvm.dimensionDisplayText[a]},getDimensionValueFromIndex:function(a,b){return(this.tvm.dimtoValueMap[a]||[])[b]},getSelectionInfoFromDimIndexAndValue:function(a,
b){var c=[],d={};d.dimKey=this.tvm.dimensionList[a];d.val="X"===b||"*"===b?-1:parseInt(b,10);c.push(d);return c},predictNextState:function(a,b){var c=this.extendSelectionInfo(a,b);if(function(a){var b;e.each(a.selectionInfo(),function(a,c){b=-1===c.val});return b}(b)||this.tvm.exists(c.selectionInfo()))return c;a=this.extendSelectionInfo(a,b,-1);a=this.tvm.fetch(a.selectionInfo());for(var d=b=0,f,g=0;g<a.length;g++)d=this.getDimScore(a[g],c),d>b&&(f=g,b=d);return this.createNextDimSelection(a[f],
c)},getAsinToCorrespondingDimensionIndexMap:function(a){var b={};e.each(this.tvm.dimCombinations,function(c,d){b[d]=parseInt(c.split(":")[a-1])});return b}};return g});"use strict";k.when("A","url-builder").register("twister-dimsum",function(f,h){function g(a,b,c,d){this.cache;d&&(this.cache=new d);this.ajaxTimeout=a;this.batchLimit=10;this.ajaxUrl="/gp/twister/dimension?asinList\x3d###asinString###\x26vs\x3d1"+(b||"");c&&(this.ajaxUrl+="\x26deviceType\x3d"+c);(a=f.state("pwState"))&&a.isTryState&&
(this.ajaxUrl=h.addUrlParams(this.ajaxUrl,{isTryState:"true"}))}var e=f.$;g.prototype={get:function(a,b,c){function d(a){var b=a-this.batchLimit;0<b&&d.call(this,b);if(a=m.slice(0>b?0:b,a).join(","))a=this.ajaxUrl.replace("###asinString###",a),f.ajax(a,{chunk:g,timeout:this.ajaxTimeout})}function g(a){if(a)for(var d in a)if(a.hasOwnProperty(d)){var e=a[d];if(e&&e.asin){if(n){var f=h(e.asin,c);n.put(f,e)}b&&b(e)}}}function h(a,b){var c=a;f.objectIsEmpty(b)||(c={asin:a},e.extend(!0,c,b));return c}var n=
this.cache,m=[],k={};e.each(a,function(a,d){a=h(d,c);n&&n.get(a)?b?b(n.get(a)):k[d]=n.get(a):m.push(d)});if(!b)return k;d.call(this,m.length)}};return g});"use strict";k.when("A").register("twister-slots-dimsum",function(f){function h(a,c,d){this.cache=e;this.ajaxTimeout=a;this.batchLimit=8;this.ajaxUrl="/gp/twister/dimension?isDimensionSlotsAjax\x3d1\x26asinList\x3d###asinString###\x26vs\x3d1"+(c||"");d&&(this.ajaxUrl+="\x26deviceType\x3d"+d);this.defaultQuerryParamsObj={};this.defaultAddedQueryParamString=
""}var g=f.$,e={},a={};h.prototype={get:function(b,c){function d(a){var b=a-this.batchLimit;0<b&&d.call(this,b);a=m.slice(0>b?0:b,a);if(b=a.join(","))b=this.ajaxUrl.replace("###asinString###",b),b+="\x26"+this.defaultAddedQueryParamString,f.ajax(b,{chunk:h,timeout:this.ajaxTimeout,cache:!0,error:e.apply(null,a)})}function e(){var b=arguments;return function(){f.each(b,function(b){delete a[b]})}}function h(b){if(b&&b.ASIN){var d=b.ASIN;n[d]=b;for(c&&c(b);a[d]&&a[d].length;)a[d].pop()(b);delete a[d]}}
var n=this.cache,m=[],k={};g.each(b,function(b,d){n[d]?c?c(n[d]):k[d]=n[d]:a[d]&&c?a[d].push(c):c&&(m.push(d),a[d]=[])});if(!c)return k;m.length&&d.call(this,m.length)},addDefaultQueryParameter:function(a,c){var d=!1;void 0!==c&&(this.defaultQuerryParamsObj[a]=c,this.defaultAddedQueryParamString=g.param(this.defaultQuerryParamsObj),d=!0);return d},getBatchSize:function(){return 8}};return h});"use strict";k.register("twister-metadata",function(){function f(){this.config={}}f.prototype={process:function(f,
g,e){"METADATA"===f&&e(g)}};return f});"use strict";k.when("A").register("publisherSubscriber",function(f){function h(){this.Subscribers=[];this.Names=[]}var g=f.$;h.prototype={register:function(e,a){if(-1<f.indexOfArray(this.Names,e))return!1;this.Names.push(e);this.Subscribers.push({name:e,handler:a})},deRegister:function(e){var a=f.indexOfArray(this.Names,e),b=this,c=function(a,c){if(a.name===e)return b.Subscribers.splice(c,1),!0};return-1<a?(this.Names.splice(a,1),[].some?this.Subscribers.some(c):
g.each(this.Subscribers,function(a,b){c(b,a)}),!0):!1},publish:function(){var e=arguments;g.each(this.Subscribers,function(a,b){setTimeout(function(){b.handler.apply(null,e)},0)})}};return h});"use strict";k.when("jQuery","twister-core-store-utils").register("twister-state-machine",function(f,h){return function(f,e,a){function b(a,b){this.selected=function(){return a};this.peek=function(){return b}}function c(a){var c=e.createSelectionInfo(a),d=l();if(d.peek().matches(c))return!1;if(-1===a.val)return k=
d=new b(l.selected(),l.selected()),!0;a=e.predictNextState(d.peek(),c);k=d=new b(d.selected(),a);return!0}function d(a){var c=l();a=e.createSelectionInfo(a);var d=e.getDimensionInfo();if(c.selected().matches(a))return!1;c=a.selectionInfo().length!==d.length?e.predictNextState(c.selected(),a):a;k=new b(c,c);return!0}var l,k;this.StoreUtils=h;this.accept=function(a,b){switch(a){case "VARIATION_PEEK":a=this.StoreUtils.branch(c(b),this.currentState);break;case "VARIATION_CHANGE":a=this.StoreUtils.branch(d(b),
this.currentState);break;default:a=this.StoreUtils.branch(!1)}return a};l=this.currentState=function(){return k};k=new b(e.createSelectionInfo(a),e.createSelectionInfo(a))}});"use strict";k.register("twister-core-store-utils",function(f){return{branch:function(f,g){return{THEN:function(e){if(f&&e){var a=g?g():f;e(a)}return this},ELSE:function(e){if(!f&&e){var a=g?g():f;e(a)}return this}}}}});"use strict";k.when("A","twister-core-store-utils").register("variation-sequence-alter",function(f,h){return function(g){function e(a,
b){var c=a[0],d=b[0];a=a[1];b=b[1];return a===b?r[c]-r[d]:a-b}function a(){if(n)return!0;var a=[];r=g.getAsinToCorrespondingDimensionIndexMap(k);f.each(m,function(b,c){b.sort(e);a=a.concat(b)});var b=c(a);n=p=d(r,b);return!0}function b(a){var b=!1;q||(b=a?a.asinToOfferInfoMap:void 0,k=a?a.slotRowNumber:void 0,b=b&&k?(m=l(b))?!0:!1:!1,q=b);return b}function c(a){var b={};f.each(a,function(a,c){b[a[0]]=c});return b}function d(a,b){var c=[];f.each(a,function(a,d){c.push([a,b[d]])});return c}function l(a){var b=
{};f.each(a,function(a,c){var d=a.split(":");a=d[0];d=d[1];b[a]=b[a]?b[a]:[];b[a].push([c,d])});return b}var k,n,m={},p,r,q=!1;this.StoreUtils=h;this.accept=function(c,d){switch(c){case "VARIATION_SEQUENCE_ALTER":c=this.StoreUtils.branch(a(d),this.getAlteredIndicesMap);break;case "INIT_SEQUENCE_ALTER_DATA":c=this.StoreUtils.branch(b(d));break;default:c=this.StoreUtils.branch(!1)}return c};this.getAlteredIndicesMap=function(){return n}}});"use strict";k.when("A").register("twister-variation-matrix",
function(f){function h(b){b=f.copy(b);var c=this;this.dimCombinations=b.dimCombinations;this.validCombinatonString=" "+f.keys(b.dimCombinations).join("  ")+" ";this.dimensionInfo=b.dimensionInfo;this.dimensionList=b.dimensionList;this.dimensionDisplayText=b.dimensionDisplayText;this.config=b.config;this.dimInfoMap={};a.each(this.dimensionInfo,function(a,b){var e=b.dimKey,f={};f.size=b.size;f.dimOrder=a;c.dimInfoMap[e]=f});this.dimtoValueMap=b.dimtoValueMap}function g(b){b=a.map(b,function(a){a=a.val;
return-1===a?"\\d+":""+a}).join(":");return new RegExp("\\s"+b+"\\s","gm")}function e(b){return a.map(b,function(a){return""+a.val}).join(":")}var a=f.$;h.prototype={fetch:function(b){b=g(b);b=this.validCombinatonString.match(b);return b=a.map(b,function(b){return a.trim(b)})},exists:function(a){return e(a)in this.dimCombinations}};return h});"use strict";k.when("A","jQuery").register("url-builder",function(f,h){function g(a,c){var d;if(a&&c&&"object"==typeof c){d=a;var e="?";f.each(c,function(a,
b){a=c[b];d+=e+b+"\x3d"+a;e="\x26"})}return d}function e(a){var c;a&&(c=a.split("?")[0]);return c}function a(a){var c={};a&&(a=a.split("?"),1<a.length&&(a=a[1].split("\x26"),f.each(a,function(a,b){a=a.split("\x3d");c[a[0]]=a[1]})));return c}return{addUrlParams:function(b,c){var d=b;b&&c&&"object"==typeof c&&(d=e(b),b=a(b),b=h.extend(b,c),d=g(d,b));return d},removeUrlParams:function(b,c){var d=b;if(b&&c&&"object"==typeof c){var d=e(b),h=a(b);f.each(c,function(a,b){delete h[a]});d=g(d,h)}return d}}})});